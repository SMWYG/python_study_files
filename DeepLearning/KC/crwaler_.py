#개 209종
# \
#     "Affenpinscher,Afghan Hound,Airedale Terrier,Akita,Alaskan Malamute,American English Coonhound,American Eskimo Dog," \
#     "American Foxhound,American Pit Bull Terrier,American Water Spaniel,Anatolian Shepherd Dog,Appenzeller Sennenhunde," \
#     "Australian Cattle Dog,Australian Shepherd,Australian Terrier,Azawakh,Barbet,Basenji,Basset Hound,Beagle,Bearded Collie," \
#     "Bedlington Terrier,Belgian Malinois,Belgian Sheepdog,Belgian Tervuren,Berger Picard,Bernese Mountain Dog," \
#     "Bichon Frise,Black and Tan Coonhound,Black Russian Terrier,Bloodhound,Bluetick Coonhound,Bolognese,Border Collie," \
#     "Border Terrier,Borzoi,Boston Terrier,Bouvier des Flandres,Boxer,Boykin Spaniel,Bracco Italiano,Briard,Brittany," \
#     "Brussels Griffon,Bull Terrier,Bulldog,Bullmastiff,Cairn Terrier,Canaan Dog,Cane Corso,Cardigan Welsh Corgi," \
#     "Catahoula Leopard Dog,Cavalier King Charles Spaniel,Cesky Terrier,Chesapeake Bay Retriever,Chihuahua,Chinese Crested," \
#     "Chinese Shar-Pei,Chinook,Chow Chow,Clumber Spaniel,Cockapoo,Cocker Spaniel,Collie,Coton de Tulear," \
#     "Curly-Coated Retriever,Dachshund,Dalmatian,Dandie Dinmont Terrier,Doberman Pinscher,Dogue de Bordeaux," \
#     "English Cocker Spaniel,English Foxhound,English Setter,English Springer Spaniel,English Toy Spaniel," \
#     "Entlebucher Mountain Dog,Field Spaniel,Finnish Lapphund,Finnish Spitz,Flat-Coated Retriever,Fox Terrier," \
#     "French Bulldog,German Pinscher,German Shepherd Dog,German Shorthaired Pointer,German Wirehaired Pointer,Giant Schnauzer," \
#     "Glen of Imaal Terrier,Goldador,Golden Retriever,Goldendoodle,Gordon Setter,Great Dane,Great Pyrenees," \
#     "Greater Swiss Mountain Dog,Greyhound,Harrier,Havanese,Ibizan Hound,Icelandic Sheepdog,Irish Red and White Setter," \
#     "Irish Setter,Irish Terrier,Irish Water Spaniel,Irish Wolfhound,Italian Greyhound,Jack Russell Terrier," \
#     "Japanese Chin,Korean Jindo Dog,Keeshond,Kerry Blue Terrier,Komondor,Kooikerhondje,Kuvasz,Labradoodle,Labrador Retriever," \
#     "Lakeland Terrier,Lancashire Heeler,Leonberger,Lhasa Apso,Lowchen,Maltese,Maltese Shih Tzu,Maltipoo,Manchester Terrier," \
#     "Mastiff,Miniature Pinscher,Miniature Schnauzer,Mutt,Neapolitan Mastiff,Newfoundland,Norfolk Terrier,Norwegian Buhund," \
#     "Norwegian Elkhound,Norwegian Lundehund,Norwich Terrier,Nova Scotia Duck Tolling Retriever,Old English Sheepdog,Otterhound," \
#     "Papillon,Peekapoo,Pekingese,Pembroke Welsh Corgi,Petit Basset Griffon Vendeen,Pharaoh Hound,Plott,Pocket Beagle,Pointer," \
#     "Polish Lowland Sheepdog,Pomeranian,Poodle,Portuguese Water Dog,Pug,Puggle,Puli,Pyrenean Shepherd,Rat Terrier," \
#     "Redbone Coonhound,Rhodesian Ridgeback, Rottweiler,Saint Bernard,Saluki,Samoyed,Schipperke,Schnoodle,Scottish Deerhound," \
#     "Scottish Terrier,Sealyham Terrier,Shetland Sheepdog,Shiba Inu,Shih Tzu,Siberian Husky,Silky Terrier,Skye Terrier," \
#     "Sloughi,Small Munsterlander Pointer,Soft Coated Wheaten Terrier,Stabyhoun,Staffordshire Bull Terrier,Standard Schnauzer," \
#     "Sussex Spaniel,Swedish Vallhund,Tibetan Mastiff,Tibetan Spaniel,Tibetan Terrier,Toy Fox Terrier," \
#     "Treeing Tennessee Brindle,Treeing Walker Coonhound,Vizsla,Weimaraner,Welsh Springer Spaniel,Welsh Terrier," \
#     "West Highland White Terrier,Whippet Wirehaired Pointing Griffon,Xoloitzcuintli,Yorkipoo,Yorkshire Terrier"

# 고양이 49종
# \
#     "Abyssinian,American Bobtail,American Curl,American Shorthair,American Wirehair,Balinese,Bengal Cats,Birman,Bombay," \
#     "British Shorthair,Burmese,Burmilla,Chartreux,Chinese Li Hua,Colorpoint Shorthair,Cornish Rex,Cymric,Devon Rex," \
#     "Egyptian Mau,European Burmese,Exotic,Havana Brown,Himalayan,Japanese Bobtail,Javanese,Korat,LaPerm,Maine Coon," \
#     "Manx,Nebelung,Norwegian Forest,Ocicat,Oriental,Persian,Ragamuffin,Ragdoll Cats,Russian Blue,Savannah,Scottish Fold," \
#     "Selkirk Rex,Siamese Cat,Siberian,Singapura,Snowshoe,Somali,Sphynx,Tonkinese,Turkish Angora,Turkish Van"


# 꽃 종류
# \
#     "Anemone,Amaryllis,Amaranthus,Aster,Azalea,Gypsophila,Begonia,Campanula,Monarda didyma,Strelitzia," \
#     "Hyacinthoides non-scripta,Callistemon,Ranunculus,Camellia,Dianthus caryophyllus,Sakura," \
#     "Chrysanthemum,Aquilegia,Clover,Crocus,Bellis perennis,Dahlia,Narcissus,Delphinium,Leontopodium alpinum," \
#     "Primulaceae,Myosotis,Digitalis,Freesia,Gerbera,Gladiolus,Hibiscus,Hyacinthus,Holly,Cypripedioideae," \
#     "Lavender,Syringa,Lilium,Nelumbo,Tagetes,Marjoram,Mimosa,Narcissus,Choisya,Orchidaceae,Peach Blossom," \
#     "Peony,Petunia,Rhododendron,Rosemary,Salvia,Antirrhinum,Helianthus annuus,Tansy,Thistle,Thyme," \
#     "Nymphaea Odorata,Zinnia"


import urllib.request #웹상의 데이터를 처리할 때 필요한 모듈
from  bs4 import BeautifulSoup #웹 파싱을 위한 라이브러리
from selenium import webdriver
from selenium.webdriver.common.keys import Keys #웹드라이버 다루는 selenium import
import time #중간중간 sleep을 걸어야해서 time모듈을 import한다.

class googleImageCrawler():

    __CHROMDRIVER_PATH = "C:\\Users\\dahan\\PycharmProjects\\"
    __DATA_PATH = "C:\\Users\\dahan\\Downloads\\"
    __URL = "https://www.google.com/imghp?hl=en"
    __KEYWORD_LIST = "tkked123"


    def __init__(self):
        self.driver = webdriver.Chrome(googleImageCrawler.__CHROMDRIVER_PATH + 'chromedriver')
        self.keyword_list = googleImageCrawler.__KEYWORD_LIST.split(',')
        self.scrollDown_count = 12
        self.image_num = 1
        self.driver.get(googleImageCrawler.__URL)
        self.playCrawling() # 객체 생성하자마자 크롤링 시작


    def playCrawling(self): # 전체 구조 : 하나의 키워드를 넣고 거기에 나오는 이미지를 다 긁어서 다운로드 그런다음 다음 키워드로 for문 이동
        count = len(self.keyword_list)
        for _ in range(count): # _는 i가 쓰일 일이 없으므로 그냥 지정한것임(사용 되지 않음을 표시)
            try:
                if len(self.keyword_list) != 0:
                    self.searchKeyword()
                    self.scrollDown()
                    images = self.scrapingImage()
                    self.saveImage(images)
                else:
                    self.driver.quit() # close()는 하나의 브라우저를 끄는 것이고 quit은 모든 브라우저를 끄는 것
                    return
            except:
                print("Exception 발생")
                continue


    def searchKeyword(self):
        keyword = self.keyword_list.pop() # 맨 마지막 요소를 가져옴(그리고 리스트에서 삭제)
        print("Searching image keyword : {}".format(keyword))
        elem = self.driver.find_element_by_id("lst-ib") #lst-ib는 크롤링 하려는 해당 홈페이지의 검색어 입력 폼의 id 가 lst-ib여서 저거 입력 (즉, 홈페이지마다 다를 것임)
        elem.send_keys(keyword)
        elem.submit()
        elem = self.driver.find_element_by_id("lst-ib")
        elem.clear() #입력창에 입력되어 있는 검색어 지움 (다음 검색어의 원활한 검색을 위해)


    def clickMoreButton(self):

        self.driver.find_element_by_id('smb').send_keys(Keys.ENTER)  # 해당 포커스한 요소에서 엔터를 누른다. / keys 클래스의 ENTER 클래스 변수를 사용하는 것 (해당 변수는 special key 값을 가지고 있음)


    def scrollDown(self): #스크롤 전체 다 한 후 해당 웹페이지에 있는 이미지를 모두 긁어오는식으로 진행
        for i in range(0, self.scrollDown_count):
            time.sleep(1.5) # 데이터 로딩을 기다리는 시간
            self.driver.find_element_by_xpath("//body").send_keys(Keys.END)
            if i==2:
                try:
                    time.sleep(1)
                except:
                    self.clickMoreButton()
                    continue


    def scrapingImage(self):
        html = self.driver.page_source
        soup = BeautifulSoup(html, "html.parser")
        params = [] #이미지가 담기는 리스트 생성
        imgList = soup.find_all("img", class_="rg_ic rg_i") # image의 클래스명이 rg_ic rg_i

        for img_data in imgList:
            try:
                params.append(img_data["src"]) #? 문자열 파싱이 사용된듯 이거 알아볼 것
            except:
                continue

        return params


    def saveImage(self, images):

        for image in images:
            urllib.request.urlretrieve(image, googleImageCrawler.__DATA_PATH + str(self.image_num) + ".jpg")  #다운 하는 이미지의 이름 지정 #request 과정을 통해 이미지 데이터 가져옴
            self.image_num += 1


Crawler = googleImageCrawler() #이 모듈 실행시키면 크롤링 바로 시작